# memolog 実装TODO リスト

最終更新: 2025-11-13
バージョン: v0.0.15 (開発中)

## 凡例

- [ ] 未着手
- [!] 進行中
- [x] 完了
- [?] 保留・要検討

## 作業方針

- t-wada さんのTDD手法を徹底し、必ずテストを先に書いてから実装に着手する。
- TODOを新規追加する際は、「先に作成するテスト」と「テストを通す実装」の両方をセットで記述する。
- 以降のtodo.mdの記述を毎作業ごとに更新する。終わったタスクに関する記述を削除し、追加の作業があれば追加する。

---

## v0.0.15: モバイル対応

### 目標

モバイルデバイス（スマートフォン・タブレット）での使いやすさを向上させる。

### フェーズ1: Platform API の導入

#### 1.1 Platform ユーティリティの作成

- [ ] テスト: `test/platform-utils.test.ts` を作成
  - `isMobile()` が正しく判定できることをテスト
  - `isTablet()` が正しく判定できることをテスト
  - `isPhone()` が正しく判定できることをテスト
  - `isDesktop()` が正しく判定できることをテスト

- [ ] 実装: `src/utils/platform.ts` を作成
  - `isMobile()` 関数を実装
  - `isTablet()` 関数を実装
  - `isPhone()` 関数を実装
  - `isDesktop()` 関数を実装

#### 1.2 既存コードの Platform API 対応

- [ ] 各コンポーネントで Platform API を使用するよう修正
- [ ] モバイル/デスクトップで挙動を分岐

### フェーズ2: タッチ操作の最適化

#### 2.1 タップ領域の拡大

- [ ] CSS: モバイルでのボタンサイズを 44x44px 以上に調整
- [ ] CSS: アイコンサイズも調整

#### 2.2 スワイプジェスチャー

- [ ] テスト: スワイプジェスチャーのテストを作成
- [ ] 実装: メモカードにスワイプジェスチャーを追加
  - 左スワイプ: 削除オプション表示
  - 右スワイプ: ピン留めトグル

#### 2.3 長押しメニュー

- [ ] テスト: 長押しメニューのテストを作成
- [ ] 実装: メモカードに長押しメニューを追加
  - 500ms 長押しでコンテキストメニュー表示
  - ピン留め、削除、編集のオプション

### フェーズ3: レスポンシブ UI の改善

#### 3.1 モバイル向けレイアウト

- [ ] CSS: コンテナの余白を削減
- [ ] CSS: ヘッダーを省スペース化
- [ ] CSS: カテゴリタブをスクロール可能に
- [ ] CSS: メモカードの余白調整

#### 3.2 フォントサイズの最適化

- [ ] CSS: モバイルでのフォントサイズ調整
- [ ] CSS: 行間の調整

#### 3.3 モーダルの調整

- [ ] CSS: モバイルでのモーダルサイズ調整
- [ ] CSS: 設定モーダルを全画面表示に

### フェーズ4: 入力体験の改善

#### 4.1 モバイルキーボードとの連携

- [ ] 実装: フォーカス時のスクロール調整
- [ ] 実装: キーボード表示時のレイアウト調整

#### 4.2 自動フォーカス制御

- [ ] 実装: モバイルでの自動フォーカスを制御
- [ ] 実装: 明示的なフォーカス関数を追加

### フェーズ5: テストと品質保証

- [ ] モバイルデバイスでの動作確認
- [ ] タッチ操作のテスト
- [ ] レイアウトの確認
- [ ] ドキュメント整備

---

## ゴミ箱機能の返信投稿対応

### 背景と問題点

現状、返信投稿（parentId !== null）が削除されてもゴミ箱タブに表示されない。
メインビューで「ルート投稿のみ表示」のフィルタリングがゴミ箱にも適用されているため。
結果、削除された返信投稿を復元する手段がUI上に存在せず、手動でファイル編集するしかない。

### 仕様

#### 削除動作

| ゴミ箱 | 返信 | 選択         | 動作                                            |
| ------ | ---- | ------------ | ----------------------------------------------- |
| OFF    | なし | -            | 完全削除（メモ削除）                            |
| OFF    | あり | -            | 削除マーカー作成（`permanently-deleted: true`） |
| ON     | なし | -            | ゴミ箱へ移動（`trashedAt` 設定）                |
| ON     | あり | すべて削除   | 本体+子孫すべてゴミ箱へ                         |
| ON     | あり | このメモのみ | 本体のみゴミ箱へ、子孫は維持                    |

#### 表示動作

**ゴミ箱タブ:**

- 全ての削除済みメモを表示（ルート/返信問わず）
- スレッド構造を維持して表示
- 各カードに「復元」ボタン配置

**メインビュー/スレッドビュー:**

- 削除済み投稿に返信がある場合のみ、削除済みプレースホルダーを表示
- 返信がない場合は非表示
- プレースホルダー内容:
  - `permanently-deleted: true`: `[削除済み] (復元できません)`
  - `trashedAt !== null`: `[削除済み] [復元]`

#### 復元動作

- 単独投稿の復元: その投稿のみ復元
- 親投稿の復元: 削除済みの全子孫も一括復元

### 完了項目

- [x] フェーズ2: 削除ロジックの修正（53テスト成功）
- [x] フェーズ4: プレースホルダーのCSSスタイルを追加（styles.css）
- [x] フェーズ5: 復元ロジックの実装（53テスト成功）
- [x] フェーズ6: UI統合テストの実行（全1197テスト成功）

**v0.0.14のゴミ箱機能の返信投稿対応は完了しました。**

---

## v0.0.14 将来対応項目

以下の項目は SPEC_v0.0.14.md に記載されていますが、実装難易度が高いため将来対応とします。

### テストと品質保証

- [ ] E2Eテスト（主要シナリオ）
  - Obsidian上での実際の操作テスト
  - 現状は単体テストと統合テストで1206テスト実施済み
  - E2Eテストフレームワークの選定と環境構築が必要

- [ ] アクセシビリティチェック
  - スクリーンリーダー等の対応確認
  - キーボード操作の確認
  - ARIA属性の適切な使用
  - アクセシビリティ監査ツールの導入が必要

---

## v0.0.14 完了状況

### 実装完了機能

- [x] スレッド表示機能（親メモ + 返信のツリー表示）
- [x] スレッドボタンの追加（返信があるメモに表示）
- [x] スレッド表示でのインライン返信機能
- [x] 返信のカテゴリ変更ボタンを非表示化
- [x] 時系列順（古い順）で返信を表示
- [x] カテゴリタブ切り替え時にスレッド表示を自動で閉じる
- [x] 返信があるメモの削除時にオプション選択
- [x] 「返信も一緒に削除」または「返信を残して親を削除」を選択可能
- [x] ゴミ箱機能の返信対応（削除マーカー作成、一括削除/復元）
- [x] DeletedMemoPlaceholder コンポーネント
- [x] 削除済みプレースホルダーの CSS スタイル
- [x] スレッド移動機能（親の変更）
  - `changeParentId()` 関数
  - 循環参照チェック機能
  - 9個のテストを追加

### テスト実施状況

- テストスイート: 64個（全て成功）
- テスト数: 1206個（全て成功）
- カバレッジ: 95.15%

**v0.0.14 は完了しました。**
