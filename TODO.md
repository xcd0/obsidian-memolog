# memolog 実装TODO リスト

最終更新: 2025-11-04
バージョン: v0.0.15 (開発中)

## 凡例

- [ ] 未着手
- [!] 進行中
- [x] 完了
- [?] 保留・要検討

## 作業方針

- t-wada さんのTDD手法を徹底し、必ずテストを先に書いてから実装に着手する。
- TODOを新規追加する際は、「先に作成するテスト」と「テストを通す実装」の両方をセットで記述する。
- 以降のtodo.mdの記述を毎作業ごとに更新する。終わったタスクに関する記述を削除し、追加の作業があれば追加する。

---

## ゴミ箱機能の返信投稿対応

### 背景と問題点

現状、返信投稿（parentId !== null）が削除されてもゴミ箱タブに表示されない。
メインビューで「ルート投稿のみ表示」のフィルタリングがゴミ箱にも適用されているため。
結果、削除された返信投稿を復元する手段がUI上に存在せず、手動でファイル編集するしかない。

### 仕様

#### 削除動作

| ゴミ箱 | 返信 | 選択         | 動作                                            |
| ------ | ---- | ------------ | ----------------------------------------------- |
| OFF    | なし | -            | 完全削除（メモ削除）                            |
| OFF    | あり | -            | 削除マーカー作成（`permanently-deleted: true`） |
| ON     | なし | -            | ゴミ箱へ移動（`trashedAt` 設定）                |
| ON     | あり | すべて削除   | 本体+子孫すべてゴミ箱へ                         |
| ON     | あり | このメモのみ | 本体のみゴミ箱へ、子孫は維持                    |

#### 表示動作

**ゴミ箱タブ:**

- 全ての削除済みメモを表示（ルート/返信問わず）
- スレッド構造を維持して表示
- 各カードに「復元」ボタン配置

**メインビュー/スレッドビュー:**

- 削除済み投稿に返信がある場合のみ、削除済みプレースホルダーを表示
- 返信がない場合は非表示
- プレースホルダー内容:
  - `permanently-deleted: true`: `[削除済み] (復元できません)`
  - `trashedAt !== null`: `[削除済み] [復元]`

#### 復元動作

- 単独投稿の復元: その投稿のみ復元
- 親投稿の復元: 削除済みの全子孫も一括復元

### フェーズ2: 削除ロジックの修正

- [ ] ゴミ箱OFF時に返信チェックを追加するテストを作成
- [ ] テストを通すようMemoManager.deleteMemo()を修正（src/core/memo-manager.ts）
- [ ] ゴミ箱OFF時の「このメモのみ削除」ケースのテストを作成
- [ ] テストを通すようMemoManager.deleteMemoWithDescendants()を修正
- [ ] 削除マーカー作成時のファイル更新処理テストを作成
- [ ] テストを通すようファイル更新処理を実装

### フェーズ4: UIコンポーネントの実装

- [?] プレースホルダーのCSSスタイルを追加（styles.css）（後で実装）

### フェーズ5: 復元ロジックの実装

- [?] Sidebar.handleRestore()ハンドラーの動作テストを作成（Phase 6統合テストで実施）
- [?] テストを通すhandleRestore()を実装（src/ui/sidebar.ts）（Phase 6統合テストで実施）
- [?] 復元ボタンのイベントハンドラーを接続するテストを作成（Phase 6統合テストで実施）
- [?] テストを通すようイベントハンドラーを接続（Phase 6統合テストで実施）

### フェーズ6: 統合テスト

- [ ] 全テストの実行と継続的なグリーン維持
